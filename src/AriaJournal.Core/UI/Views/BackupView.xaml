<!-- =============================================================================
ÙØ§ÛŒÙ„: src/AriaJournal.Core/UI/Views/BackupView.xaml
ØªÙˆØ¶ÛŒØ­: ØµÙØ­Ù‡ Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ - Ø§ØµÙ„Ø§Ø­â€ŒØ´Ø¯Ù‡
============================================================================= -->

<UserControl x:Class="AriaJournal.Core.UI.Views.BackupView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             FlowDirection="RightToLeft"
             Background="{DynamicResource BackgroundBrush}">

    <UserControl.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVis"/>
    </UserControl.Resources>

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Ù‡Ø¯Ø± -->
        <Grid Grid.Row="0" Margin="0,0,0,20">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <TextBlock Text="ðŸ’¾ Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ Ùˆ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ"
                       FontSize="24"
                       FontWeight="Bold"
                       Foreground="{DynamicResource ForegroundBrush}"/>

            <StackPanel Grid.Column="1" Orientation="Horizontal">
                <Button Content="ðŸ”„ Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ"
                        Command="{Binding RefreshCommand}"
                        Style="{DynamicResource SecondaryButtonStyle}"
                        Margin="0,0,10,0"/>
                <Button Content="âž• Ø§ÛŒØ¬Ø§Ø¯ Ù¾Ø´ØªÛŒØ¨Ø§Ù†"
                        Command="{Binding CreateBackupCommand}"
                        Style="{DynamicResource PrimaryButtonStyle}"/>
            </StackPanel>
        </Grid>

        <!-- Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ -->
        <StackPanel Grid.Row="1">
            <Border Background="#E8F5E9"
                    CornerRadius="5"
                    Padding="10"
                    Margin="0,0,0,15"
                    Visibility="{Binding HasSuccess, Converter={StaticResource BoolToVis}}">
                <TextBlock Text="{Binding SuccessMessage}"
                           Foreground="#2E7D32"/>
            </Border>

            <Border Background="#FFEBEE"
                    CornerRadius="5"
                    Padding="10"
                    Margin="0,0,0,15"
                    Visibility="{Binding HasError, Converter={StaticResource BoolToVis}}">
                <TextBlock Text="{Binding ErrorMessage}"
                           Foreground="#C62828"/>
            </Border>
        </StackPanel>

        <!-- Ù…Ø­ØªÙˆØ§ -->
        <Grid Grid.Row="2">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- Ø§Ø·Ù„Ø§Ø¹Ø§Øª -->
            <Border Grid.Row="0"
                    Background="{DynamicResource CardBackgroundBrush}"
                    CornerRadius="10"
                    Padding="20"
                    Margin="0,0,0,15">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <StackPanel Grid.Column="0">
                        <TextBlock Text="Ù…Ø³ÛŒØ± Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ"
                                   FontSize="12"
                                   Foreground="{DynamicResource SecondaryForegroundBrush}"/>
                        <TextBlock Text="{Binding BackupPath}"
                                   FontSize="13"
                                   Foreground="{DynamicResource ForegroundBrush}"
                                   TextTrimming="CharacterEllipsis"
                                   Margin="0,5,0,0"/>
                    </StackPanel>

                    <StackPanel Grid.Column="1" HorizontalAlignment="Center">
                        <TextBlock Text="ØªØ¹Ø¯Ø§Ø¯ Ù†Ø³Ø®Ù‡â€ŒÙ‡Ø§"
                                   FontSize="12"
                                   Foreground="{DynamicResource SecondaryForegroundBrush}"
                                   HorizontalAlignment="Center"/>
                        <TextBlock Text="{Binding BackupsCount}"
                                   FontSize="24"
                                   FontWeight="Bold"
                                   Foreground="{DynamicResource ForegroundBrush}"
                                   HorizontalAlignment="Center"
                                   Margin="0,5,0,0"/>
                    </StackPanel>

                    <StackPanel Grid.Column="2" HorizontalAlignment="Left">
                        <TextBlock Text="Ø¢Ø®Ø±ÛŒÙ† Ù¾Ø´ØªÛŒØ¨Ø§Ù†"
                                   FontSize="12"
                                   Foreground="{DynamicResource SecondaryForegroundBrush}"/>
                        <TextBlock Text="{Binding LastBackupDate}"
                                   FontSize="13"
                                   Foreground="{DynamicResource ForegroundBrush}"
                                   Margin="0,5,0,0"/>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- Ù„ÛŒØ³Øª Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÙ‡Ø§ -->
            <Border Grid.Row="1"
                    Background="{DynamicResource CardBackgroundBrush}"
                    CornerRadius="10">
                <Grid>
                    <!-- Ù„ÛŒØ³Øª -->
                    <DataGrid ItemsSource="{Binding Backups}"
                              SelectedItem="{Binding SelectedBackup}"
                              AutoGenerateColumns="False"
                              IsReadOnly="True"
                              SelectionMode="Single"
                              Style="{DynamicResource DataGridStyle}"
                              Visibility="{Binding HasBackups, Converter={StaticResource BoolToVis}}">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Ù†Ø§Ù… ÙØ§ÛŒÙ„" 
                                                Binding="{Binding FileName}" 
                                                Width="*"/>
                            <DataGridTextColumn Header="ØªØ§Ø±ÛŒØ® Ø§ÛŒØ¬Ø§Ø¯" 
                                                Binding="{Binding CreatedAt, StringFormat=yyyy/MM/dd HH:mm}" 
                                                Width="150"/>
                            <DataGridTextColumn Header="Ø­Ø¬Ù…" 
                                                Binding="{Binding FileSizeDisplay}" 
                                                Width="100"/>
                            <DataGridTextColumn Header="Ø±Ù…Ø²Ù†Ú¯Ø§Ø±ÛŒ" 
                                                Binding="{Binding EncryptedDisplay}" 
                                                Width="80"/>
                            <DataGridTemplateColumn Header="Ø¹Ù…Ù„ÛŒØ§Øª" Width="150">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <StackPanel Orientation="Horizontal"
                                                    HorizontalAlignment="Center">
                                            <Button Content="Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ"
                                                    Command="{Binding DataContext.RestoreCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                                    CommandParameter="{Binding}"
                                                    Style="{DynamicResource SecondaryButtonStyle}"
                                                    Padding="10,5"
                                                    Margin="0,0,5,0"/>
                                            <Button Content="ðŸ—‘ï¸"
                                                    Command="{Binding DataContext.DeleteBackupCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                                    CommandParameter="{Binding}"
                                                    Style="{DynamicResource IconButtonStyle}"
                                                    ToolTip="Ø­Ø°Ù"/>
                                        </StackPanel>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                        </DataGrid.Columns>
                    </DataGrid>

                    <!-- Ù¾ÛŒØ§Ù… Ø®Ø§Ù„ÛŒ -->
                    <StackPanel VerticalAlignment="Center"
                                HorizontalAlignment="Center"
                                Visibility="{Binding IsEmpty, Converter={StaticResource BoolToVis}}">
                        <TextBlock Text="ðŸ“­"
                                   FontSize="64"
                                   HorizontalAlignment="Center"/>
                        <TextBlock Text="Ù‡Ù†ÙˆØ² Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø§ÛŒØ¬Ø§Ø¯ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª"
                                   FontSize="16"
                                   Foreground="{DynamicResource SecondaryForegroundBrush}"
                                   HorizontalAlignment="Center"
                                   Margin="0,15,0,0"/>
                        <Button Content="Ø§ÛŒØ¬Ø§Ø¯ Ø§ÙˆÙ„ÛŒÙ† Ù¾Ø´ØªÛŒØ¨Ø§Ù†"
                                Command="{Binding CreateBackupCommand}"
                                Style="{DynamicResource PrimaryButtonStyle}"
                                Margin="0,20,0,0"/>
                    </StackPanel>

                    <!-- Ù„ÙˆØ¯ÛŒÙ†Ú¯ -->
                    <Border Background="#80000000"
                            Visibility="{Binding IsBusy, Converter={StaticResource BoolToVis}}">
                        <StackPanel VerticalAlignment="Center"
                                    HorizontalAlignment="Center">
                            <ProgressBar IsIndeterminate="True"
                                         Width="200"
                                         Height="4"/>
                            <TextBlock Text="{Binding BusyMessage}"
                                       Foreground="White"
                                       HorizontalAlignment="Center"
                                       Margin="0,15,0,0"/>
                        </StackPanel>
                    </Border>
                </Grid>
            </Border>
        </Grid>

        <!-- Ø¯ÛŒØ§Ù„ÙˆÚ¯ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± -->
        <Border Grid.RowSpan="3"
                Background="#80000000"
                Visibility="{Binding IsPasswordDialogOpen, Converter={StaticResource BoolToVis}}">
            <Border Background="{DynamicResource CardBackgroundBrush}"
                    CornerRadius="10"
                    Padding="30"
                    Width="400"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center">
                <StackPanel>
                    <TextBlock Text="{Binding PasswordDialogTitle}"
                               FontSize="16"
                               FontWeight="Bold"
                               Foreground="{DynamicResource ForegroundBrush}"
                               Margin="0,0,0,20"/>

                    <PasswordBox x:Name="PasswordBox"
                                 Padding="10"
                                 FontSize="14"
                                 Margin="0,0,0,20"/>

                    <StackPanel Orientation="Horizontal"
                                HorizontalAlignment="Left">
                        <Button Content="ØªØ£ÛŒÛŒØ¯"
                                Command="{Binding ConfirmPasswordCommand}"
                                Style="{DynamicResource PrimaryButtonStyle}"
                                Width="100"
                                Margin="0,0,10,0"
                                Click="ConfirmPassword_Click"/>
                        <Button Content="Ø§Ù†ØµØ±Ø§Ù"
                                Command="{Binding CancelPasswordCommand}"
                                Style="{DynamicResource SecondaryButtonStyle}"
                                Width="100"/>
                    </StackPanel>
                </StackPanel>
            </Border>
        </Border>
    </Grid>
</UserControl>

<!-- =============================================================================
Ù¾Ø§ÛŒØ§Ù† ÙØ§ÛŒÙ„
============================================================================= -->