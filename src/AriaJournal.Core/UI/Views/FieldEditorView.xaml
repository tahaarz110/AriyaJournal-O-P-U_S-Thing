<!-- =============================================================================
ÙØ§ÛŒÙ„: src/AriaJournal.Core/UI/Views/FieldEditorView.xaml
ØªÙˆØ¶ÛŒØ­: Ù¾Ù†Ù„ GUI Ø¨Ø±Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ùˆ Ø³ÙØ§Ø±Ø´ÛŒâ€ŒØ³Ø§Ø²ÛŒ ÙÛŒÙ„Ø¯Ù‡Ø§
============================================================================= -->

<UserControl x:Class="AriaJournal.Core.UI.Views.FieldEditorView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d"
             FlowDirection="RightToLeft"
             Background="{DynamicResource BackgroundBrush}"
             d:DesignHeight="600" d:DesignWidth="800">

    <UserControl.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVis"/>
    </UserControl.Resources>

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Ù‡Ø¯Ø± -->
        <StackPanel Grid.Row="0" Margin="0,0,0,20">
            <TextBlock Text="ðŸ”§ Ù…Ø¯ÛŒØ±ÛŒØª ÙÛŒÙ„Ø¯Ù‡Ø§"
                       FontSize="20"
                       FontWeight="Bold"
                       Foreground="{DynamicResource ForegroundBrush}"/>
            <TextBlock Text="Ø¯Ø± Ø§ÛŒÙ† Ø¨Ø®Ø´ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ ÙØ±Ù… Ø±Ø§ Ù…Ø¯ÛŒØ±ÛŒØª Ùˆ Ø³ÙØ§Ø±Ø´ÛŒâ€ŒØ³Ø§Ø²ÛŒ Ú©Ù†ÛŒØ¯"
                       FontSize="13"
                       Foreground="{DynamicResource SecondaryForegroundBrush}"
                       Margin="0,5,0,0"/>
        </StackPanel>

        <!-- Ø§Ù†ØªØ®Ø§Ø¨ ÙØ±Ù… -->
        <Border Grid.Row="1"
                Background="{DynamicResource CardBackgroundBrush}"
                CornerRadius="8"
                Padding="15"
                Margin="0,0,0,15">
            <StackPanel Orientation="Horizontal">
                <TextBlock Text="ÙØ±Ù…:"
                           VerticalAlignment="Center"
                           Foreground="{DynamicResource ForegroundBrush}"
                           Margin="0,0,10,0"/>
                <ComboBox ItemsSource="{Binding AvailableForms}"
                          SelectedItem="{Binding SelectedForm}"
                          DisplayMemberPath="TitleFa"
                          Width="250"
                          Style="{DynamicResource ComboBoxStyle}"/>
                <Button Content="ðŸ”„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…Ø¬Ø¯Ø¯"
                        Command="{Binding RefreshCommand}"
                        Style="{DynamicResource SecondaryButtonStyle}"
                        Margin="15,0,0,0"/>
            </StackPanel>
        </Border>

        <!-- Ù„ÛŒØ³Øª ÙÛŒÙ„Ø¯Ù‡Ø§ -->
        <Border Grid.Row="2"
                Background="{DynamicResource CardBackgroundBrush}"
                CornerRadius="8"
                Padding="15">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Ù†ÙˆØ§Ø± Ø§Ø¨Ø²Ø§Ø± -->
                <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,10">
                    <Button Content="âž• ÙÛŒÙ„Ø¯ Ø¬Ø¯ÛŒØ¯"
                            Command="{Binding AddFieldCommand}"
                            Style="{DynamicResource PrimaryButtonStyle}"
                            Margin="0,0,10,0"/>
                    <Button Content="ðŸ“‹ ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ù¾ÛŒØ´â€ŒÙØ±Ø¶"
                            Command="{Binding ShowDefaultFieldsCommand}"
                            Style="{DynamicResource SecondaryButtonStyle}"
                            Margin="0,0,10,0"/>
                    <Button Content="â†©ï¸ Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ"
                            Command="{Binding ResetCommand}"
                            Style="{DynamicResource SecondaryButtonStyle}"/>
                </StackPanel>

                <!-- Ù„ÛŒØ³Øª -->
                <ListView Grid.Row="1"
                          ItemsSource="{Binding Fields}"
                          SelectedItem="{Binding SelectedField}"
                          Background="Transparent"
                          BorderThickness="0">
                    <ListView.View>
                        <GridView>
                            <GridViewColumn Width="50">
                                <GridViewColumn.CellTemplate>
                                    <DataTemplate>
                                        <CheckBox IsChecked="{Binding Visible}"
                                                  ToolTip="Ù†Ù…Ø§ÛŒØ´/Ù…Ø®ÙÛŒ"/>
                                    </DataTemplate>
                                </GridViewColumn.CellTemplate>
                            </GridViewColumn>

                            <GridViewColumn Header="Ù†Ø§Ù… ÙÛŒÙ„Ø¯" Width="150">
                                <GridViewColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding LabelFa}"
                                                   Foreground="{DynamicResource ForegroundBrush}"/>
                                    </DataTemplate>
                                </GridViewColumn.CellTemplate>
                            </GridViewColumn>

                            <GridViewColumn Header="Ù†ÙˆØ¹" Width="100">
                                <GridViewColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding TypeDisplay}"
                                                   Foreground="{DynamicResource SecondaryForegroundBrush}"/>
                                    </DataTemplate>
                                </GridViewColumn.CellTemplate>
                            </GridViewColumn>

                            <GridViewColumn Header="Ø§Ù„Ø²Ø§Ù…ÛŒ" Width="60">
                                <GridViewColumn.CellTemplate>
                                    <DataTemplate>
                                        <CheckBox IsChecked="{Binding Required}"
                                                  IsEnabled="{Binding CanEdit}"/>
                                    </DataTemplate>
                                </GridViewColumn.CellTemplate>
                            </GridViewColumn>

                            <GridViewColumn Header="ØªØ±ØªÛŒØ¨" Width="70">
                                <GridViewColumn.CellTemplate>
                                    <DataTemplate>
                                        <StackPanel Orientation="Horizontal">
                                            <Button Content="â–²"
                                                    Command="{Binding DataContext.MoveUpCommand, RelativeSource={RelativeSource AncestorType=ListView}}"
                                                    CommandParameter="{Binding}"
                                                    Style="{DynamicResource IconButtonStyle}"
                                                    Width="24" Height="24"/>
                                            <Button Content="â–¼"
                                                    Command="{Binding DataContext.MoveDownCommand, RelativeSource={RelativeSource AncestorType=ListView}}"
                                                    CommandParameter="{Binding}"
                                                    Style="{DynamicResource IconButtonStyle}"
                                                    Width="24" Height="24"/>
                                        </StackPanel>
                                    </DataTemplate>
                                </GridViewColumn.CellTemplate>
                            </GridViewColumn>

                            <GridViewColumn Header="Ø¹Ù…Ù„ÛŒØ§Øª" Width="100">
                                <GridViewColumn.CellTemplate>
                                    <DataTemplate>
                                        <StackPanel Orientation="Horizontal">
                                            <Button Content="âœï¸"
                                                    Command="{Binding DataContext.EditFieldCommand, RelativeSource={RelativeSource AncestorType=ListView}}"
                                                    CommandParameter="{Binding}"
                                                    Style="{DynamicResource IconButtonStyle}"
                                                    ToolTip="ÙˆÛŒØ±Ø§ÛŒØ´"
                                                    Width="28" Height="28"/>
                                            <Button Content="ðŸ—‘ï¸"
                                                    Command="{Binding DataContext.DeleteFieldCommand, RelativeSource={RelativeSource AncestorType=ListView}}"
                                                    CommandParameter="{Binding}"
                                                    Style="{DynamicResource IconButtonStyle}"
                                                    ToolTip="Ø­Ø°Ù"
                                                    Width="28" Height="28"
                                                    Visibility="{Binding IsCustom, Converter={StaticResource BoolToVis}}"/>
                                        </StackPanel>
                                    </DataTemplate>
                                </GridViewColumn.CellTemplate>
                            </GridViewColumn>
                        </GridView>
                    </ListView.View>
                </ListView>
            </Grid>
        </Border>

        <!-- Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ù¾Ø§ÛŒÛŒÙ† -->
        <StackPanel Grid.Row="3"
                    Orientation="Horizontal"
                    HorizontalAlignment="Left"
                    Margin="0,15,0,0">
            <Button Content="ðŸ’¾ Ø°Ø®ÛŒØ±Ù‡ ØªØºÛŒÛŒØ±Ø§Øª"
                    Command="{Binding SaveCommand}"
                    Style="{DynamicResource PrimaryButtonStyle}"
                    Width="150"
                    Margin="0,0,10,0"/>
            <Button Content="Ø§Ù†ØµØ±Ø§Ù"
                    Command="{Binding CancelCommand}"
                    Style="{DynamicResource SecondaryButtonStyle}"
                    Width="100"/>
        </StackPanel>

        <!-- Ù¾Ù†Ù„ ÙˆÛŒØ±Ø§ÛŒØ´ ÙÛŒÙ„Ø¯ -->
        <Border Grid.Row="0" Grid.RowSpan="4"
                Background="#80000000"
                Visibility="{Binding IsEditPanelVisible, Converter={StaticResource BoolToVis}}">
            <Border Background="{DynamicResource CardBackgroundBrush}"
                    CornerRadius="10"
                    Padding="25"
                    MaxWidth="500"
                    MaxHeight="600"
                    VerticalAlignment="Center"
                    HorizontalAlignment="Center">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <TextBlock Grid.Row="0"
                               Text="{Binding EditPanelTitle}"
                               FontSize="18"
                               FontWeight="Bold"
                               Foreground="{DynamicResource ForegroundBrush}"
                               Margin="0,0,0,20"/>

                    <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
                        <StackPanel>
                            <!-- Ù†Ø§Ù… ÙÛŒÙ„Ø¯ -->
                            <StackPanel Margin="0,0,0,15">
                                <TextBlock Text="Ù†Ø§Ù… Ù†Ù…Ø§ÛŒØ´ÛŒ *"
                                           Foreground="{DynamicResource ForegroundBrush}"
                                           Margin="0,0,0,5"/>
                                <TextBox Text="{Binding EditingField.LabelFa, UpdateSourceTrigger=PropertyChanged}"
                                         Style="{DynamicResource TextBoxStyle}"/>
                            </StackPanel>

                            <!-- Ø´Ù†Ø§Ø³Ù‡ ÙÛŒÙ„Ø¯ -->
                            <StackPanel Margin="0,0,0,15"
                                        Visibility="{Binding EditingField.IsCustom, Converter={StaticResource BoolToVis}}">
                                <TextBlock Text="Ø´Ù†Ø§Ø³Ù‡ ÙÛŒÙ„Ø¯ * (Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ)"
                                           Foreground="{DynamicResource ForegroundBrush}"
                                           Margin="0,0,0,5"/>
                                <TextBox Text="{Binding EditingField.FieldName, UpdateSourceTrigger=PropertyChanged}"
                                         Style="{DynamicResource TextBoxStyle}"
                                         IsEnabled="{Binding EditingField.IsNew}"/>
                            </StackPanel>

                            <!-- Ù†ÙˆØ¹ ÙÛŒÙ„Ø¯ -->
                            <StackPanel Margin="0,0,0,15">
                                <TextBlock Text="Ù†ÙˆØ¹ ÙÛŒÙ„Ø¯"
                                           Foreground="{DynamicResource ForegroundBrush}"
                                           Margin="0,0,0,5"/>
                                <ComboBox ItemsSource="{Binding FieldTypes}"
                                          SelectedItem="{Binding EditingField.FieldType}"
                                          DisplayMemberPath="DisplayName"
                                          SelectedValuePath="Value"
                                          Style="{DynamicResource ComboBoxStyle}"
                                          IsEnabled="{Binding EditingField.IsCustom}"/>
                            </StackPanel>

                            <!-- Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ (Ø¨Ø±Ø§ÛŒ select) -->
                            <StackPanel Margin="0,0,0,15"
                                        Visibility="{Binding EditingField.ShowOptions, Converter={StaticResource BoolToVis}}">
                                <TextBlock Text="Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ (Ù‡Ø± Ø®Ø· ÛŒÚ© Ú¯Ø²ÛŒÙ†Ù‡)"
                                           Foreground="{DynamicResource ForegroundBrush}"
                                           Margin="0,0,0,5"/>
                                <TextBox Text="{Binding EditingField.OptionsText, UpdateSourceTrigger=PropertyChanged}"
                                         Style="{DynamicResource TextBoxStyle}"
                                         AcceptsReturn="True"
                                         Height="100"
                                         TextWrapping="Wrap"
                                         VerticalScrollBarVisibility="Auto"/>
                            </StackPanel>

                            <!-- Ù…Ù‚Ø¯Ø§Ø± Ù¾ÛŒØ´â€ŒÙØ±Ø¶ -->
                            <StackPanel Margin="0,0,0,15">
                                <TextBlock Text="Ù…Ù‚Ø¯Ø§Ø± Ù¾ÛŒØ´â€ŒÙØ±Ø¶"
                                           Foreground="{DynamicResource ForegroundBrush}"
                                           Margin="0,0,0,5"/>
                                <TextBox Text="{Binding EditingField.DefaultValue, UpdateSourceTrigger=PropertyChanged}"
                                         Style="{DynamicResource TextBoxStyle}"/>
                            </StackPanel>

                            <!-- ØªÙ†Ø¸ÛŒÙ…Ø§Øª -->
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,15">
                                <CheckBox Content="Ø§Ù„Ø²Ø§Ù…ÛŒ"
                                          IsChecked="{Binding EditingField.Required}"
                                          Foreground="{DynamicResource ForegroundBrush}"
                                          Margin="0,0,20,0"/>
                                <CheckBox Content="Ù†Ù…Ø§ÛŒØ´"
                                          IsChecked="{Binding EditingField.Visible}"
                                          Foreground="{DynamicResource ForegroundBrush}"/>
                            </StackPanel>
                        </StackPanel>
                    </ScrollViewer>

                    <!-- Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ -->
                    <StackPanel Grid.Row="2"
                                Orientation="Horizontal"
                                HorizontalAlignment="Left"
                                Margin="0,20,0,0">
                        <Button Content="âœ”ï¸ ØªØ£ÛŒÛŒØ¯"
                                Command="{Binding ConfirmEditCommand}"
                                Style="{DynamicResource PrimaryButtonStyle}"
                                Width="100"
                                Margin="0,0,10,0"/>
                        <Button Content="Ø§Ù†ØµØ±Ø§Ù"
                                Command="{Binding CancelEditCommand}"
                                Style="{DynamicResource SecondaryButtonStyle}"
                                Width="100"/>
                    </StackPanel>
                </Grid>
            </Border>
        </Border>
    </Grid>
</UserControl>

<!-- =============================================================================
Ù¾Ø§ÛŒØ§Ù† ÙØ§ÛŒÙ„: src/AriaJournal.Core/UI/Views/FieldEditorView.xaml
============================================================================= -->